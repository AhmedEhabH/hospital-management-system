<div class="patient-dashboard" [class.dark-theme]="isDarkMode">
	<!-- Loading State -->
	<div *ngIf="isLoading" class="loading-container">
		<mat-progress-spinner mode="indeterminate" diameter="60"></mat-progress-spinner>
		<h3>Loading your health dashboard...</h3>
		<p>Fetching your latest medical data from our secure database</p>
	</div>

	<!-- Error State -->
	<div *ngIf="error && !isLoading" class="error-container">
		<mat-icon>error_outline</mat-icon>
		<h3>Unable to Load Dashboard</h3>
		<p>{{ error }}</p>
		<button mat-raised-button color="primary" (click)="refreshData()">
			<mat-icon>refresh</mat-icon>
			Try Again
		</button>
	</div>

	<!-- Dashboard Content -->
	<div *ngIf="!isLoading && !error && dashboardData" class="dashboard-content">
		<!-- Header Section -->
		<div class="dashboard-header medical-gradient header-layout">
			<div class="header-content">
				<h1>Welcome back, {{ dashboardData.userInfo.firstName }}!</h1>
				<p>Your personal health dashboard with real-time data from our medical database</p>
			</div>
			<div class="header-actions">
				<button mat-icon-button (click)="refreshData()" matTooltip="Refresh Data">
					<mat-icon>refresh</mat-icon>
				</button>
			</div>
		</div>

		<!-- Stats Cards -->
		<div class="medical-gradient stats-container">
			<div class="stats-cards">
				<div class="stat-card">
					<mat-icon>science</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ dashboardData.labReports.length }}</span>
						<span class="stat-label">Lab Reports</span>
					</div>
				</div>

				<div class="stat-card" [class.critical]="criticalAlerts.length > 0">
					<mat-icon>warning</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ criticalAlerts.length }}</span>
						<span class="stat-label">Critical Alerts</span>
					</div>
				</div>

				<div class="stat-card">
					<mat-icon>mail</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ unreadMessages.length }}</span>
						<span class="stat-label">New Messages</span>
					</div>
				</div>

				<div class="stat-card">
					<mat-icon>event</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ dashboardData.upcomingAppointments.length }}</span>
						<span class="stat-label">Upcoming</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Main Content Grid -->
		<div class="container content-container">
			<div class="content-grid two-column">

				<!-- Health Metrics Card -->
				<div class="medical-card" *ngIf="dashboardData.healthMetrics">
					<mat-card>
						<mat-card-header>
							<mat-card-title>Current Health Metrics</mat-card-title>
							<mat-card-subtitle>Real-time data from medical devices</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							<div class="health-metrics-grid">
								<div class="metric-item">
									<mat-icon>favorite</mat-icon>
									<div class="metric-info">
										<span class="metric-value">{{ dashboardData.healthMetrics.heartRate.value }}
											BPM</span>
										<span class="metric-label">Heart Rate</span>
										<span class="status-stable">{{ dashboardData.healthMetrics.heartRate.status
											}}</span>
									</div>
								</div>

								<div class="metric-item">
									<mat-icon>monitor_heart</mat-icon>
									<div class="metric-info">
										<span class="metric-value">
											{{ dashboardData.healthMetrics.bloodPressure.systolic }}/{{
											dashboardData.healthMetrics.bloodPressure.diastolic }}
										</span>
										<span class="metric-label">Blood Pressure</span>
										<span class="status-stable">{{ dashboardData.healthMetrics.bloodPressure.status
											}}</span>
									</div>
								</div>
							</div>
						</mat-card-content>
					</mat-card>
				</div>

				<!-- Recent Lab Reports -->
				<div class="medical-card">
					<mat-card>
						<mat-card-header>
							<mat-card-title>Recent Lab Reports</mat-card-title>
							<mat-card-subtitle>Latest {{ recentLabReports.length }} reports from
								database</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							<div *ngIf="recentLabReports.length === 0" class="empty-state">
								<mat-icon>science</mat-icon>
								<p>No lab reports available</p>
							</div>

							<div *ngFor="let report of recentLabReports" class="report-item">
								<div class="report-info">
									<h4>{{ report.testPerformed }}</h4>
									<p>Tested by: {{ report.testedBy }}</p>
									<span class="report-date">{{ report.testedDate | date:'short' }}</span>
								</div>
								<button mat-icon-button (click)="viewLabReport(report.id)" matTooltip="View Report">
									<mat-icon>visibility</mat-icon>
								</button>
							</div>
						</mat-card-content>
						<mat-card-actions>
							<button mat-button (click)="viewLabReport(0)">View All Reports</button>
						</mat-card-actions>
					</mat-card>
				</div>

				<!-- Medical History Summary -->
				<div class="medical-card">
					<mat-card>
						<mat-card-header>
							<mat-card-title>Medical History</mat-card-title>
							<mat-card-subtitle>{{ dashboardData.medicalHistory.length }} records in
								database</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							<div *ngIf="dashboardData.medicalHistory.length === 0" class="empty-state">
								<mat-icon>history</mat-icon>
								<p>No medical history recorded</p>
							</div>

							<div *ngFor="let history of dashboardData.medicalHistory.slice(0, 3)" class="history-item">
								<div class="history-info">
									<p><strong>Allergies:</strong> {{ history.allergies || 'None recorded' }}</p>
									<p><strong>Current Medications:</strong> {{ history.currentMedications || 'None
										recorded' }}</p>
									<div class="conditions">
										<span *ngIf="history.hasAsthma" class="condition-tag">Asthma</span>
										<span *ngIf="history.hasBloodPressure" class="condition-tag">Blood
											Pressure</span>
										<span *ngIf="history.hasDiabetes" class="condition-tag">Diabetes</span>
									</div>
								</div>
							</div>
						</mat-card-content>
						<mat-card-actions>
							<button mat-button (click)="viewMedicalHistory()">View Complete History</button>
						</mat-card-actions>
					</mat-card>
				</div>

				<!-- Upcoming Appointments -->
				<div class="medical-card">
					<mat-card>
						<mat-card-header>
							<mat-card-title>Upcoming Appointments</mat-card-title>
							<mat-card-subtitle>{{ dashboardData.upcomingAppointments.length }} scheduled
								appointments</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							<div *ngIf="dashboardData.upcomingAppointments.length === 0" class="empty-state">
								<mat-icon>event</mat-icon>
								<p>No upcoming appointments</p>
							</div>

							<div *ngFor="let appointment of dashboardData.upcomingAppointments"
								class="appointment-item">
								<div class="appointment-info">
									<h4>{{ appointment.doctorName }}</h4>
									<p>{{ appointment.department }} - {{ appointment.type }}</p>
									<span class="appointment-time">{{ appointment.date | date:'short' }} at {{
										appointment.time }}</span>
								</div>
								<mat-icon class="appointment-icon">event</mat-icon>
							</div>
						</mat-card-content>
					</mat-card>
				</div>
			</div>
		</div>
	</div>
</div>