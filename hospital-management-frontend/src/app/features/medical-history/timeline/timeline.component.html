<div class="enhanced-medical-timeline" [class.dark-theme]="isDarkMode">
	<!-- Header Section with Statistics -->
	<div class="timeline-header medical-gradient">
		<div class="header-content">
			<div class="header-main">
				<h1 class="timeline-title">
					<mat-icon>timeline</mat-icon>
					Medical History Timeline
				</h1>
				<p class="timeline-subtitle">Comprehensive chronological view of your medical journey</p>
			</div>

			<!-- Statistics Cards -->
			<div class="stats-cards">
				<div class="stat-card">
					<mat-icon>event_note</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ timelineStats.totalEvents }}</span>
						<span class="stat-label">Total Events</span>
					</div>
				</div>
				<div class="stat-card">
					<mat-icon>calendar_today</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ timelineStats.thisMonth }}</span>
						<span class="stat-label">This Month</span>
					</div>
				</div>
				<div class="stat-card critical">
					<mat-icon>priority_high</mat-icon>
					<div class="stat-info">
						<span class="stat-number">{{ timelineStats.criticalEvents }}</span>
						<span class="stat-label">High Priority</span>
					</div>
				</div>
			</div>
		</div>

		<div class="header-actions">
			<app-theme-toggle></app-theme-toggle>
			<app-logout-button></app-logout-button>
		</div>
	</div>

	<!-- Loading State -->
	<div *ngIf="isLoading" class="loading-container">
		<mat-progress-bar mode="indeterminate" class="loading-bar"></mat-progress-bar>
		<div class="loading-content">
			<mat-icon class="loading-icon pulse-animation">timeline</mat-icon>
			<p>Loading your comprehensive medical timeline...</p>
		</div>
	</div>

	<!-- Main Content -->
	<div *ngIf="!isLoading" class="timeline-main-content">
		<div class="container">

			<!-- Search and Filter Section -->
			<div class="search-filter-section">
				<mat-card class="filter-card medical-card">
					<mat-card-header>
						<mat-icon mat-card-avatar>filter_list</mat-icon>
						<mat-card-title>Search & Filter</mat-card-title>
						<mat-card-subtitle>Find specific medical events</mat-card-subtitle>
					</mat-card-header>

					<mat-card-content>
						<!-- Search Bar -->
						<div class="search-section">
							<mat-form-field class="search-field" appearance="outline">
								<mat-label>Search medical events</mat-label>
								<input matInput [formControl]="searchControl"
									placeholder="Search by title, description, or tags...">
								<mat-icon matSuffix>search</mat-icon>
							</mat-form-field>
						</div>

						<!-- Filter Chips -->
						<div class="filter-chips-section">
							<div class="filter-group">
								<h4>Event Types</h4>
								<div class="filter-chips">
									<mat-chip-listbox>
										<mat-chip-option *ngFor="let type of availableEventTypes"
											[selected]="filterOptions.eventTypes.includes(type.value)"
											(click)="toggleEventTypeFilter(type.value)"
											[style.background-color]="filterOptions.eventTypes.includes(type.value) ? type.color : 'transparent'"
											[style.color]="filterOptions.eventTypes.includes(type.value) ? 'white' : type.color">
											<mat-icon>{{ type.icon }}</mat-icon>
											{{ type.label }}
										</mat-chip-option>
									</mat-chip-listbox>
								</div>
							</div>

							<div class="filter-group">
								<h4>Priority Levels</h4>
								<div class="filter-chips">
									<mat-chip-listbox>
										<mat-chip-option *ngFor="let priority of availablePriorities"
											[selected]="filterOptions.priorities.includes(priority.value)"
											(click)="togglePriorityFilter(priority.value)"
											[style.background-color]="filterOptions.priorities.includes(priority.value) ? priority.color : 'transparent'"
											[style.color]="filterOptions.priorities.includes(priority.value) ? 'white' : priority.color">
											{{ priority.label }}
										</mat-chip-option>
									</mat-chip-listbox>
								</div>
							</div>
						</div>

						<!-- Filter Actions -->
						<div class="filter-actions">
							<button mat-button color="primary" (click)="clearAllFilters()">
								<mat-icon>clear_all</mat-icon>
								Clear All Filters
							</button>
							<button mat-raised-button color="accent" (click)="exportTimeline()">
								<mat-icon>file_download</mat-icon>
								Export Timeline
							</button>
						</div>
					</mat-card-content>
				</mat-card>
			</div>

			<!-- Results Summary -->
			<div class="results-summary" *ngIf="filteredTimelineEvents.length !== allTimelineEvents.length">
				<mat-card class="summary-card">
					<mat-card-content>
						<div class="summary-content">
							<mat-icon>filter_alt</mat-icon>
							<span>Showing {{ filteredTimelineEvents.length }} of {{ allTimelineEvents.length }}
								events</span>
							<button mat-button color="primary" (click)="clearAllFilters()">
								Show All
							</button>
						</div>
					</mat-card-content>
				</mat-card>
			</div>

			<!-- Health Trends Chart -->
			<div class="health-trends-section">
				<mat-card class="chart-card medical-card">
					<mat-card-header>
						<mat-icon mat-card-avatar>show_chart</mat-icon>
						<mat-card-title>Health Trends Analysis</mat-card-title>
						<mat-card-subtitle>6-month health metrics overview</mat-card-subtitle>
					</mat-card-header>
					<mat-card-content>
						<div class="chart-container">
							<canvas 
								baseChart
								[data]="healthTrendsChartData" 
								[type]="healthTrendsChartType"
								[options]="chartOptions">
							</canvas>
						</div>
					</mat-card-content>
				</mat-card>
			</div>

			<!-- Enhanced Timeline -->
			<div class="enhanced-timeline-section">
				<div class="timeline-container">

					<!-- Timeline Events -->
					<div class="enhanced-timeline">
						<div *ngFor="let event of filteredTimelineEvents; let i = index"
							class="timeline-event-container" [class]="getEventTypeClass(event.type)">

							<!-- Timeline Connector -->
							<div class="timeline-connector" *ngIf="i < filteredTimelineEvents.length - 1"></div>

							<!-- Event Marker -->
							<div class="timeline-marker" [style.background-color]="event.color"
								[class]="getPriorityClass(event.priority)">
								<mat-icon>{{ event.icon }}</mat-icon>
							</div>

							<!-- Event Card -->
							<div class="timeline-event-card medical-card">
								<div class="event-header">
									<div class="event-meta">
										<div class="event-date">{{ formatDate(event.date) }}</div>
										<div class="event-type-badge" [style.background-color]="event.color">
											{{ event.type | titlecase }}
										</div>
										<div class="priority-badge" [class]="getPriorityClass(event.priority)">
											{{ event.priority | titlecase }} Priority
										</div>
									</div>
									<div class="event-actions">
										<button mat-icon-button (click)="viewEventDetails(event)"
											matTooltip="View Details">
											<mat-icon>visibility</mat-icon>
										</button>
										<button mat-icon-button (click)="editEvent(event)" matTooltip="Edit Event">
											<mat-icon>edit</mat-icon>
										</button>
									</div>
								</div>

								<div class="event-content">
									<h3 class="event-title">{{ event.title }}</h3>
									<p class="event-description">{{ event.description }}</p>

									<!-- Event Tags -->
									<div class="event-tags" *ngIf="event.tags.length > 0">
										<mat-chip-listbox>
											<mat-chip *ngFor="let tag of event.tags" class="event-tag">
												{{ tag }}
											</mat-chip>
										</mat-chip-listbox>
									</div>

									<!-- Medical Data -->
									<div *ngIf="event.data" class="event-data">
										<div class="data-section" *ngIf="event.type === 'medical'">
											<h4>Medical Conditions</h4>
											<div class="conditions-grid">
												<div *ngIf="event.data.hasAsthma" class="condition-item">
													<mat-icon>air</mat-icon>
													<span>Asthma</span>
												</div>
												<div *ngIf="event.data.hasDiabetes" class="condition-item">
													<mat-icon>bloodtype</mat-icon>
													<span>Diabetes</span>
												</div>
												<div *ngIf="event.data.hasBloodPressure" class="condition-item">
													<mat-icon>favorite</mat-icon>
													<span>Hypertension</span>
												</div>
												<div *ngIf="event.data.hasHeartDisease" class="condition-item">
													<mat-icon>monitor_heart</mat-icon>
													<span>Heart Disease</span>
												</div>
											</div>
										</div>

										<div class="data-section" *ngIf="event.type === 'appointment'">
											<h4>Appointment Details</h4>
											<div class="appointment-details">
												<div class="detail-item">
													<mat-icon>person</mat-icon>
													<span>{{ event.data.doctor }}</span>
												</div>
												<div class="detail-item">
													<mat-icon>local_hospital</mat-icon>
													<span>{{ event.data.department }}</span>
												</div>
											</div>
										</div>

										<div class="data-section" *ngIf="event.type === 'medication'">
											<h4>Medication Information</h4>
											<div class="medication-details">
												<div class="detail-item">
													<mat-icon>medication</mat-icon>
													<span>{{ event.data.medication }}</span>
												</div>
												<div class="detail-item">
													<mat-icon>schedule</mat-icon>
													<span>{{ event.data.dosage }}</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Empty State -->
					<div *ngIf="filteredTimelineEvents.length === 0" class="empty-state">
						<mat-icon class="empty-icon">timeline</mat-icon>
						<h3>No Events Found</h3>
						<p *ngIf="allTimelineEvents.length === 0">Your medical timeline will appear here as records are
							added.</p>
						<p *ngIf="allTimelineEvents.length > 0">No events match your current filters. Try adjusting your
							search criteria.</p>
						<button mat-raised-button color="primary" (click)="clearAllFilters()"
							*ngIf="allTimelineEvents.length > 0">
							<mat-icon>clear_all</mat-icon>
							Clear Filters
						</button>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>